í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ - V5  
====================  

```java
public interface ControllerV3 {
    ModelView process(Map<String, String> paramMap);
}
```
```java
public interface ControllerV4 {
    String process(Map<String, String> paramMap, Map<String, Object> model);
}
```

ì–´ë–¤ ìƒí™©ì—ì„œ ControllerV3 ë°©ì‹ìœ¼ë¡œ ê°œë°œí•˜ê³  ì‹¶ê³ ,    
ì–´ë–¤ ìƒí™©ì—ì„œ ControllerV4 ë°©ì‹ìœ¼ë¡œ ê°œë°œí•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?      

ë‘ ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ëŠ” ë‹¤ë¥´ë¯€ë¡œ ì´ë¥¼ ë°”ë¡œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í˜ë“¤ ê²ƒì´ë‹¤.     
ê·¸ëŸ¬ë‚˜ ì´ **ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ì™€ ìƒê´€ì—†ì´ FrontControllerì™€ í˜¸í™˜ë˜ëŠ” `ì–´ëŒ‘í„°`ê°€ ì¡´ì¬í•œë‹¤ë©´ ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.**     


# ğŸ“— V5 êµ¬ì¡° 

![v5](https://user-images.githubusercontent.com/50267433/126856391-f1db3e9c-a7ea-4116-90bf-ad1f8f06435a.PNG)
 
ë‹¤ì–‘í•œ í˜•íƒœì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•œ `Adapter íŒ¨í„´`ì„ ì ‘ëª©ì‹œí‚¨ ê²ƒì´ V5 ëª¨ë¸ì´ë‹¤.        
   
* **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° :**     
    ì¤‘ê°„ì— ì¶”ê°€ëœ ì–´ëŒ‘í„° ì´ë¦„ì€ **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°**ì´ë‹¤.       
    í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ëŠ” **ì—°ê²°í•  Controllerì˜ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ì— ë”°ë¼ ì½”ë“œë¥¼ ì•Œë§ê²Œ ì •ì˜í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.**        
    ë‹¨, í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ê°„ì˜ ê³µí†µ ê·œì•…ì´ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì˜ ë”°ë¥´ë©´ì„œ ì§„í–‰í•´ì•¼ í•œë‹¤.          
    ì–´ëŒ‘í„° ì—­í• ì„ í•´ì£¼ëŠ” ë•ë¶„ì— ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.     
    
* **í•¸ë“¤ëŸ¬ :** 
  **ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ì„ ë” ë„“ì€ ë²”ìœ„ì¸ í•¸ë“¤ëŸ¬ë¡œ ë³€ê²½í–ˆë‹¤.**      
    ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ê°œë… ë¿ë§Œ ì•„ë‹ˆë¼ ì–´ë– í•œ ê²ƒì´ë“  í•´ë‹¹í•˜ëŠ” ì¢…ë¥˜ì˜ ì–´ëŒ‘í„°ë§Œ ìˆìœ¼ë©´ ë‹¤ ì²˜ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
 
## ğŸ“– FrontController
```java
@WebServlet(name = "frontControllerServletV5", urlPatterns = "/front-controller/v5/*")
public class FrontControllerServletV5 extends HttpServlet {

    private final Map<String, Object> handlerMappingMap = new HashMap<>();
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();

    public FrontControllerServletV5() {
        initHandlerMapping();
        initHandlerAdapter();
    }

    private void initHandlerMapping() {
        handlerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());

        handlerMappingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());

    }

    private void initHandlerAdapter() {
        handlerAdapters.add(new ControllerV3HandlerAdapter());
        handlerAdapters.add(new ControllerV4HandlerAdapter());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        Object handler = handler(request);
        if (handler == null) {
            response.setStatus(SC_NOT_FOUND);
        }
        MyHandlerAdapter handlerAdapter = handlerAdapter(handler);
        ModelView modelView = handlerAdapter.handle(request, response, handler);
        MyView myView = viewResolver(modelView.viewName());
        myView.render(modelView.model(), request, response);
    }

    private Object handler(HttpServletRequest request) {
        String requestURI = request.getRequestURI();
        return handlerMappingMap.get(requestURI);
    }

    private MyHandlerAdapter handlerAdapter(Object handler) {
        for (MyHandlerAdapter handlerAdapter : handlerAdapters) {
            if (handlerAdapter.supports(handler)) {
                return handlerAdapter;
            }
        }
        throw new IllegalArgumentException("handler adapterë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler=" + handler);
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }

}
```
  
* `HandlerMapping`ì—ì„œ URLê³¼ ë§¤í•‘ë˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì¡°íšŒí•˜ê³            
* `HandlerAdapter ëª©ë¡` ì—ì„œ **í•¸ë“¤ëŸ¬ì™€ ì•Œë§ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì›í•˜ëŠ” HandlerAdapterë¥¼ ë¶ˆëŸ¬ì™€ ì‹¤í–‰í•œë‹¤**        
* `HandlerAdapter`ì˜ ê²°ê³¼ë¡œ ë°˜í™˜ë  ModelViewë¥¼ í†µí•´ ëª¨ë¸ì„ ì„¸íŒ…í•˜ê³  View ë Œë”ë§ì„ ì§„í–‰í•˜ë©´ ëœë‹¤.      

## ğŸ“– MyHandlerAdapter
```java
public interface MyHandlerAdapter {

    boolean supports(Object handler);

    ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException;
}
```
**í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¸í„°í˜ì´ìŠ¤**ë¡œ   
Controllerë§ˆë‹¤ ì‚¬ìš©ë˜ëŠ” ì‹œê·¸ë‹ˆì²˜ê°€ ë‹¬ë¼ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë¡œì§ì€ ë‹¤ë¥´ì§€ë§Œ,     
ìµœì†Œ ì†Œì¤€ì˜ ê³µí†µ ê·œì•½ì„ ì •í•´ FrontControllerì—ì„œ ì¼ê´€ëœ ë¡œì§ì„ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.     
       
**ì‚¬ìš© ê°€ëŠ¥ ìœ ë¬´ íŒë‹¨ ë©”ì„œë“œ**
* `boolean supports(Object handler)`
* handlerëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§í•œë‹¤.
* ì–´ëŒ‘í„°ê°€ í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ íŒë‹¨í•˜ëŠ” ë©”ì„œë“œë‹¤.
   
**Controller ë¡œì§ ì‹¤í–‰ì„ ìœ„í•œ ë©”ì„œë“œ**
* `ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler)`     
* ì–´ëŒ‘í„°ëŠ” ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê³ , ê·¸ ê²°ê³¼ë¡œ ModelViewë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤.     
* ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ModelViewë¥¼ ë°˜í™˜í•˜ì§€ ëª»í•˜ë©´, ì–´ëŒ‘í„°ê°€ ModelViewë¥¼ ì§ì ‘ ìƒì„±í•´ì„œë¼ë„ ë°˜í™˜í•´ì•¼ í•œë‹¤.     
* ì´ì „ì—ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ ì´ì œëŠ” ì´ ì–´ëŒ‘í„°ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤.       
   
## ğŸ“– ControllerV3HandlerAdapter
```java
public class ControllerV3HandlerAdapter implements MyHandlerAdapter {

    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV3);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {
        ControllerV3 controller = (ControllerV3) handler;
        return controller.process(paramMap(request));
    }

    private Map<String, String> paramMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}
```
ControllerV3ì— ë§ê²Œë” ì½”ë“œë¥¼ êµ¬ì„±í•œ Adapterì´ë‹¤.   
ê·¸ì „ì—ëŠ” FrontControllerì—ì„œ ì§ì ‘ Controllerë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ,   
í˜„ì¬ëŠ” FrontControllerê°€ ì•„ë‹Œ `HandlerAdatper êµ¬í˜„ì²´` ì—ì„œ ì§ì ‘ ì²˜ë¦¬ë¥¼ í•  ê²ƒì´ë©°   
FrontControllerì—ì„œëŠ” requestì™€ View ì„¸íŒ…ì„ í•˜ë„ë¡ ì½”ë“œë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.  
   
## ğŸ“– ControllerV4HandlerAdapter
```java
public class ControllerV4HandlerAdapter implements MyHandlerAdapter {

    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV4);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {
        ControllerV4 controller = (ControllerV4) handler;

        Map<String, String> paramMap = paramMap(request);
        Map<String, Object> model = new HashMap<>();

        String viewName = controller.process(paramMap, model);
        ModelView modelView = new ModelView(viewName);
        modelView.setModel(model);
        return modelView;
    }

    private Map<String, String> paramMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}
```
ControllerV4ì— ë§ê²Œë” ì½”ë“œë¥¼ êµ¬ì„±í•œ Adapterì´ë‹¤.   
ê·¸ì „ì—ëŠ” FrontControllerì—ì„œ ì§ì ‘ Controllerë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ,   
í˜„ì¬ëŠ” FrontControllerê°€ ì•„ë‹Œ `HandlerAdatper êµ¬í˜„ì²´` ì—ì„œ ì§ì ‘ ì²˜ë¦¬ë¥¼ í•  ê²ƒì´ë©°   
FrontControllerì—ì„œëŠ” requestì™€ View ì„¸íŒ…ì„ í•˜ë„ë¡ ì½”ë“œë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.  

# ì •ë¦¬
ì§€ê¸ˆê¹Œì§€ v1 ~ v5ë¡œ ì ì§„ì ìœ¼ë¡œ í”„ë ˆì„ì›Œí¬ë¥¼ ë°œì „ì‹œì¼œ ì™”ë‹¤.

* **v1: í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…**  
    * ê¸°ì¡´ êµ¬ì¡°ë¥¼ ìµœëŒ€í•œ ìœ ì§€í•˜ë©´ì„œ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…
* **v2: View ë¶„ë¥˜**
    * ë‹¨ìˆœ ë°˜ë³µ ë˜ëŠ” ë·° ë¡œì§ ë¶„ë¦¬
* **v3: Model ì¶”ê°€**
    * ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°
    * ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°
* **v4: ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬**  
    * v3ì™€ ê±°ì˜ ë¹„ìŠ·
    * êµ¬í˜„ ì…ì¥ì—ì„œ ModelViewë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ ë°˜í™˜í•˜ì§€ ì•Šë„ë¡ í¸ë¦¬í•œ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
* **v5: ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬**     
    * ì–´ëŒ‘í„° ë„ì… 
    * ì–´ëŒ‘í„°ë¥¼ ì¶”ê°€í•´ì„œ í”„ë ˆì„ì›Œí¬ë¥¼ ìœ ì—°í•˜ê³  í™•ì¥ì„± ìˆê²Œ ì„¤ê³„   
    * ì—¬ê¸°ì— ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë” í¸ë¦¬í•˜ê²Œ ë°œì „ì‹œê¸¸ ìˆ˜ë„ ìˆë‹¤. ë§Œì•½ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ       
      ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?           
      ë°”ë¡œ ì• ë…¸í…Œì´ì…˜ì„ ì§€ì›í•˜ëŠ” ì–´ëŒ‘í„°ë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤!    
    * ë‹¤í˜•ì„±ê³¼ ì–´ëŒ‘í„° ë•ë¶„ì— ê¸°ì¡´ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ, í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤.     
     
**ìŠ¤í”„ë§ MVC**  
ì—¬ê¸°ì„œ ë” ë°œì „ì‹œí‚¤ë©´ ì¢‹ê² ì§€ë§Œ, ìŠ¤í”„ë§ MVCì˜ í•µì‹¬ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ëŠ”ë° í•„ìš”í•œ ë¶€ë¶„ì€ ëª¨ë‘ ë§Œë“¤ì–´ë³´ì•˜ë‹¤.   
ì‚¬ì‹¤ì€ ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ì½”ë“œëŠ” ìŠ¤í”„ë§ MVC í”„ë ˆì„ì›Œí¬ì˜ í•µì‹¬ ì½”ë“œì˜ ì¶•ì•½ ë²„ì „ì´ê³ , êµ¬ì¡°ë„ ê±°ì˜ ê°™ë‹¤.     
ìŠ¤í”„ë§ MVCì—ëŠ” ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ í•™ìŠµí•œ ë‚´ìš©ê³¼ ê±°ì˜ ê°™ì€ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤      
      
