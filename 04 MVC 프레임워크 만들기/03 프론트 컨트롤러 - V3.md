í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ - V3
=======================  
   
ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°
ì»¨íŠ¸ë¡¤ëŸ¬ ì…ì¥ì—ì„œ HttpServletRequest, HttpServletResponseì´ ê¼­ í•„ìš”í• ê¹Œ?
ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” ìë°”ì˜ Mapìœ¼ë¡œ ëŒ€ì‹  ë„˜ê¸°ë„ë¡ í•˜ë©´ ì§€ê¸ˆ êµ¬ì¡°ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„
ëª°ë¼ë„ ë™ì‘í•  ìˆ˜ ìˆë‹¤.
ê·¸ë¦¬ê³  request ê°ì²´ë¥¼ Modelë¡œ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì— ë³„ë„ì˜ Model ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•˜ë©´ ëœë‹¤.
ìš°ë¦¬ê°€ êµ¬í˜„í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ë³€ê²½í•´ë³´ì.
ì´ë ‡ê²Œ í•˜ë©´ êµ¬í˜„ ì½”ë“œë„ ë§¤ìš° ë‹¨ìˆœí•´ì§€ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì´ ì‰½ë‹¤.
ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§€ì •í•˜ëŠ” ë·° ì´ë¦„ì— ì¤‘ë³µì´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë°˜í™˜í•˜ê³ , ì‹¤ì œ ë¬¼ë¦¬ ìœ„ì¹˜ì˜ ì´ë¦„ì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë‹¨ìˆœí™”
í•˜ì.
ì´ë ‡ê²Œ í•´ë‘ë©´ í–¥í›„ ë·°ì˜ í´ë” ìœ„ì¹˜ê°€ í•¨ê»˜ ì´ë™í•´ë„ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ê³ ì¹˜ë©´ ëœë‹¤.
/WEB-INF/views/new-form.jsp new-form
/WEB-INF/views/save-result.jsp save-result
/WEB-INF/views/members.jsp members

# ğŸ“˜ V3 êµ¬ì¡° 

![v3](https://user-images.githubusercontent.com/50267433/126672741-b1935d82-b903-47b9-8fab-5f796d63bb6f.PNG)   
      
**ModelView**      
ê¸°ì¡´ì—ëŠ” `request.setAttribute()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë·°ì— ì „ë‹¬í–ˆë‹¤.(Model ì—­í• )                
ê·¸ëŸ¬ë‚˜ `HttpServletRequest`ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ê¸°ëŠ¥ì´ ë„ˆë¬´ ë§ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ì–´ë µë‹¤.                        
ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°ë¥¼ ìœ„í•´ **Modelì„ ë§Œë“¤ê³ , View ì´ë¦„ê¹Œì§€ ì „ë‹¬í•˜ëŠ” ê°ì²´ `ModelView`ë¥¼ ë§Œë“¤ì–´ë³´ì.**         

ì˜ˆì œë¥¼ ìœ„í•œ `ModelView` ê°ì²´ëŠ” ë‹¤ë¥¸ ë²„ì „ì—ì„œë„ ì‚¬ìš©í•˜ë¯€ë¡œ íŒ¨í‚¤ì§€ë¥¼ `frontcontroller`ì— ë‘”ë‹¤.

## FrontController 
```java
@WebServlet(name = "frontControllerServletV3", urlPatterns = "/frontcontroller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {
    
    private Map<String, ControllerV3> controllerMap = new HashMap<>();
    
    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }
    
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI();
        ControllerV3 controller = controllerMap.get(requestURI);
        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }
        Map<String, String> paramMap = createParamMap(request);
        ModelView mv = controller.process(paramMap);
        String viewName = mv.getViewName();
        MyView view = viewResolver(viewName);
        view.render(mv.getModel(), request, response);
    }
    
    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
    
    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```
`FrontController`ì—ì„œëŠ” `HttpServletRequest request`ë¥¼ í™œìš©í•´             
**`Map<String, String> paramMap`ì— íŒŒë¼ë¯¸í„° ì´ë¦„ê³¼ ê·¸ ê°’ì„ ë§¤í•‘í•˜ì—¬ ì €ì¥ì‹œí‚¨ë‹¤.**            
     
ì´í›„, ìƒì„±ëœ `paramMap`ì„ controllerì— ì£¼ì…ì‹œì¼œ Model ê°’ê³¼ ViewNameì„ ê°€ì§„ `ModelView`ë¥¼ ë°˜í™˜í•˜ë„ë¡ í•œë‹¤.            
ì°¸ê³ ë¡œ, ì´ë•Œ ë°˜í™˜ëœ **`ViewName`ì€ ë‹¨ìˆœí•œ ê²½ë¡œë§Œì„ ë‚˜íƒ€ë‚¸ë‹¤.(prefixì™€ suffixë¥¼ ê°€ì§€ ì•Šì€ ê²½ë¡œ)**          


## ğŸ“– ModelView   
`ModelView`ëŠ” 'ë·°ì˜ ì´ë¦„'ê³¼ 'ë·°ë¥¼ ë Œë”ë§í•  ë•Œ í•„ìš”í•œ model ê°ì²´'ë¥¼ ê°€ì§€ê³  ìˆë‹¤.    

```java
public class ModelView {

    private String viewName;
    private Map<String, Object> model = new HashMap<>();
    
    public ModelView(String viewName) {
        this.viewName = viewName;
    }
    public String getViewName() {
        return viewName;
    }
    public void setViewName(String viewName) {
        this.viewName = viewName;
    }
    public Map<String, Object> getModel() {
        return model;
    }
    public void setModel(Map<String, Object> model) {
       this.model = model;
    }
}
```   
Modelì€ ë‹¨ìˆœíˆ Mapìœ¼ë¡œ ë˜ì–´ ìˆìœ¼ë¯€ë¡œ **Controllerë¡œë¶€í„° ë·°ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ key, valueë¡œ ë°›ëŠ”ë‹¤.**           
 
## ğŸ“– Controller ì¸í„°í˜ì´ìŠ¤
```java
public interface ControllerV3 {
    ModelView process(Map<String, String> paramMap);
}
```
`HttpServletRequest`ê°€ ì œê³µí•˜ëŠ” **íŒŒë¼ë¯¸í„°ëŠ” FrontControllerê°€ paramMapì— ë‹´ì•„ì„œ í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤.**      
**ì‘ë‹µ ê²°ê³¼ë¡œ ë·° ì´ë¦„ê³¼ ë·°ì— ì „ë‹¬í•  Model ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ModelView ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ ëœë‹¤.**           

## ğŸ“– Controller êµ¬í˜„ì²´ - íšŒì› ë“±ë¡ í¼
```java
public class MemberFormControllerV3 implements ControllerV3 {
 
    @Override
    public ModelView process(Map<String, String> paramMap) {
        return new ModelView("new-form");
    }
}
```
ì´ì „ê³¼ ë‹¤ë¥´ê²Œ prefix, suffixë¥¼ ì œì™¸í•œ viewì˜ ë…¼ë¦¬ì ì¸ ì´ë¦„ë§Œ ì €ì¥í•œë‹¤.    
ì‹¤ì œ ë¬¼ë¦¬ì ì¸ ì´ë¦„ì€ Front Controller ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ 

## ğŸ“– Controller êµ¬í˜„ì²´ - íšŒì› ì €ì¥
```java
public class MemberSaveControllerV3 implements ControllerV3 {
    
    private MemberRepository memberRepository = MemberRepository.getInstance();
    
    @Override
    public ModelView process(Map<String, String> paramMap) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));
        Member member = new Member(username, age);
        memberRepository.save(member);
        ModelView mv = new ModelView("save-result");
        mv.getModel().put("member", member);
        return mv;
    }
}
```   
   
* `paramMap.get("username");`    
  íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” mapì— ë‹´ê²¨ìˆë‹¤.         
  mapì—ì„œ í•„ìš”í•œ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì¡°íšŒí•˜ë©´ ëœë‹¤.         
* `mv.getModel().put("member", member);`   
  ëª¨ë¸ì€ ë‹¨ìˆœí•œ mapì´ë¯€ë¡œ ëª¨ë¸ì— ë·°ì—ì„œ í•„ìš”í•œ member ê°ì²´ë¥¼ ë‹´ê³  ë°˜í™˜í•œë‹¤.       
   
## ğŸ“– MemberListControllerV3 - íšŒì› ëª©ë¡
```java
public class MemberListControllerV3 implements ControllerV3 {
    
    private MemberRepository memberRepository = MemberRepository.getInstance();
    
    @Override
    public ModelView process(Map<String, String> paramMap) {
        List<Member> members = memberRepository.findAll();
        ModelView mv = new ModelView("members");
        mv.getModel().put("members", members);
        return mv;
    }
}
```

```java
@WebServlet(name = "frontControllerServletV3", urlPatterns = "/frontcontroller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {
    
    private Map<String, ControllerV3> controllerMap = new HashMap<>();
    
    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }
 
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI();
        ControllerV3 controller = controllerMap.get(requestURI);
        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }
        Map<String, String> paramMap = createParamMap(request);
        ModelView mv = controller.process(paramMap);
        String viewName = mv.getViewName();
        MyView view = viewResolver(viewName);
        view.render(mv.getModel(), request, response);
   }
 
    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
    
    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```

view.render(mv.getModel(), request, response) ì½”ë“œì—ì„œ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²ƒì´ë‹¤. ë‹¤ìŒ
ì½”ë“œë¥¼ ì°¸ê³ í•´ì„œ MyView ê°ì²´ì— í•„ìš”í•œ ë©”ì„œë“œë¥¼ ì¶”ê°€í•˜ì.
createParamMap()
HttpServletRequestì—ì„œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ êº¼ë‚´ì„œ Mapìœ¼ë¡œ ë³€í™˜í•œë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ Map( paramMap )ì„
ì»¨íŠ¸ë¡¤ëŸ¬ì— ì „ë‹¬í•˜ë©´ì„œ í˜¸ì¶œí•œë‹¤.
ë·° ë¦¬ì¡¸ë²„
MyView view = viewResolver(viewName)
ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°˜í™˜í•œ ë…¼ë¦¬ ë·° ì´ë¦„ì„ ì‹¤ì œ ë¬¼ë¦¬ ë·° ê²½ë¡œë¡œ ë³€ê²½í•œë‹¤. ê·¸ë¦¬ê³  ì‹¤ì œ ë¬¼ë¦¬ ê²½ë¡œê°€ ìˆëŠ” MyView
ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
ë…¼ë¦¬ ë·° ì´ë¦„: members
ë¬¼ë¦¬ ë·° ê²½ë¡œ: /WEB-INF/views/members.jsp
view.render(mv.getModel(), request, response)
ë·° ê°ì²´ë¥¼ í†µí•´ì„œ HTML í™”ë©´ì„ ë Œë”ë§ í•œë‹¤.
ë·° ê°ì²´ì˜ render() ëŠ” ëª¨ë¸ ì •ë³´ë„ í•¨ê»˜ ë°›ëŠ”ë‹¤.
JSPëŠ” request.getAttribute() ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì—, ëª¨ë¸ì˜ ë°ì´í„°ë¥¼ êº¼ë‚´ì„œ
request.setAttribute() ë¡œ ë‹´ì•„ë‘”ë‹¤.
JSPë¡œ í¬ì›Œë“œ í•´ì„œ JSPë¥¼ ë Œë”ë§ í•œë‹¤.
  
## ğŸ“– MyView
```java
public class MyView {
    
    private String viewPath;
    
    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }
    
    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
    
    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        modelToRequestAttribute(model, request);
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
 
    private void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}
```
