ìš”ì²­ ë§¤í•‘ í—¨ë“¤ëŸ¬ ì–´ëí„° êµ¬ì¡°
=============================   
**HTTP ë©”ì‹œì§€ ì»¨ë²„í„°ëŠ” ìŠ¤í”„ë§ MVC ì–´ë””ì¯¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì¼ê¹Œ? ğŸ¤”**      
HTTP ë©”ì‹œì§€ ì»¨ë²„í„° ì‚¬ìš© ìœ„ì¹˜ë¥¼ ì•Œê¸° ì „ì— **`ArgumentResolver`ì™€ `ReturnValueHandler`ì— ëŒ€í•´ì„œ ì•Œê³  ê°€ì**      
    
![mvc-adapter](https://user-images.githubusercontent.com/50267433/128370135-991bf2dd-b5c9-4a62-a79d-8db95e5a9299.PNG)    
![request-handler-adapter](https://user-images.githubusercontent.com/50267433/128369947-d28f62a3-39a5-4bad-9180-03d6e3731142.PNG)     
   
# SpringMVC êµ¬ì¡°     
ëª¨ë“  ë¹„ë°€ì€ **ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬**     
ì¦‰, **`@RequestMapping`ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ì¸ `RequestMappingHandlerAdapter`ì— ìˆë‹¤.**        

## ArgumentResolver
      
**ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬**ëŠ” ë§¤ìš° ë‹¤ì–‘í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆë‹¤.      
    
* HttpServletRequest
* HttpEntity 
* Model
* @ì–´ë…¸í…Œì´ì…˜  
* ê¸°íƒ€ ë“±ë“±...  
        
ğŸ‘‰ **ì´ë ‡ê²Œ íŒŒë¼ë¯¸í„°ë¥¼ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” `ArgumentResolver` ë•ë¶„ì´ë‹¤.**              

`RequestMappingHandlerAdaptor` ëŠ” ì—¬ëŸ¬ ArgumentResolverë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí•´ì„œ        
ì»¨íŠ¸ë¡¤ëŸ¬(í•¸ë“¤ëŸ¬)ê°€ í•„ìš”ë¡œ í•˜ëŠ” ë‹¤ì–‘í•œ íŒŒë¼ë¯¸í„°ì˜ ê°’(ê°ì²´)ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤ë©´ **ìƒì„± ìš”ì²­**ì„ í•œë‹¤.        
ê·¸ë¦¬ê³  ì´ë ‡ê²Œ íŒŒë¦¬ë¯¸í„°ì˜ ê°’ì´ ëª¨ë‘ ìƒì„±ëœë‹¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ê°’ì„ ë„˜ê²¨ì¤€ë‹¤.               
    
**ìŠ¤í”„ë§ MVCëŠ”**       
`@RequestBody`, `@ResponseBody` : **RequestResponseBodyMethodProcessor (ArgumentResolver)**       
`HttpEntity`, `RequestEntity` : **HttpEntityMethodProcessor (ArgumentResolver)** 
   
**HttpEntityMethodProcessor**    
```java
    // HttpEntity ë˜ëŠ” RequestEntity íŒŒë¼ë¯¸í„° íƒ€ì…ì„ ì›í•˜ëŠ”ì§€ ê²€ì¦           
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return (HttpEntity.class == parameter.getParameterType() || RequestEntity.class == parameter.getParameterType());
    }
	   
    // HttpEntityì— ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.    	
    @Override
    @Nullable
    public Object resolveArgument(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer, 
                                  NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) throws IOException, HttpMediaTypeNotSupportedException {
				  
        ServletServerHttpRequest inputMessage = createInputMessage(webRequest);
        Type paramType = getHttpEntityType(parameter);
        if (paramType == null) {
	    throw new IllegalArgumentException("HttpEntity parameter '" + parameter.getParameterName() + "' in method " + parameter.getMethod() + " is not parameterized");
        }
	Object body = readWithMessageConverters(webRequest, parameter, paramType);
        if (RequestEntity.class == parameter.getParameterType()) {
	    return new RequestEntity<>(body, inputMessage.getHeaders(),
	    inputMessage.getMethod(), inputMessage.getURI());
	} else {
	    return new HttpEntity<>(body, inputMessage.getHeaders());
	}
    }	
```
`HttpEntityMethodProcessor`ëŠ” `HttpEntity`ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•˜ëŠ” `ArgumentResolver`ì´ë‹¤.       
ê·¸ë ‡ê¸°ì— ìœ„ ì½”ë“œì—ì„œë„ íŒŒë¼ë¯¸í„°ë¡œ `HttpEntity`ë¥¼ ì›í•˜ëŠ”ì§€ ê²€ì¦í•˜ê³  ì´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.          
(ë‹¨, í—·ê°ˆë¦¬ëŠ”ê²Œ Converterê°€ í´ë˜ìŠ¤, ë¯¸ë””í„°íƒ€ì…ì„ ë³¸ë‹¤ê³  í–ˆìœ¼ë‹ˆ ArgumentResolverëŠ” ë¯¸ë””ì–´íƒ€ì…ê³¼ ê´€ë ¨ì´ ì—†ë‹¤.)          
  
**ì •ë¦¬**    
1. RequestMappingHandlerAdaptorëŠ” **Handlerê°€ í•„ìš”ë¡œí•˜ëŠ” íŒŒë¼ë¯¸í„° ê°’ì„ íŒŒì•…í•œë‹¤.**   
2. Handlerê°€ í•„ìš”ë¡œí•˜ëŠ” **íŒŒë¼ë¯¸í„° ê°’ì´ ì—†ì„ ê²½ìš° ArgumentResolver ëª©ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ ìƒì„± ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¬»ëŠ”ë‹¤.**      
3. **íŒŒë¼ë¯¸í„° ê°’ì„ ìƒì„±í•´ì¤„ `ArgumentResolver`ë¥¼ ì°¾ìœ¼ë©´ ìƒì„±ì„ ì˜ë¢°í•œë‹¤.**   
4. `ArgumentResolver`í†µí•´ ë°˜í™˜ëœ íŒŒë¼ë¯¸í„° ê°’ë“¤ì„ í†µí•´ **ì‹¤ì œ í•¸ë“¤ëŸ¬ë¥¼ í˜¸ì¶œí•œë‹¤.**       

ìŠ¤í”„ë§ì€ 30ê°œê°€ ë„˜ëŠ” ArgumentResolver ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•œë‹¤.    

* ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„° ëª©ë¡ì€ [ê³µì‹ ë©”ë‰´ì–¼](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annarguments)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.    
* ì •í™•íˆëŠ” `HandlerMethodArgumentResolver`ì¸ë° ì¤„ì—¬ì„œ `ArgumentResolver` ë¼ê³  ë¶€ë¥¸ë‹¤.    



```java
public interface HandlerMethodArgumentResolver {

	boolean supportsParameter(MethodParameter parameter);
    
	@Nullable
	Object resolveArgument(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer,
			NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) throws Exception;
            
}
```
  
**ë™ì‘ ë°©ì‹**       
1. ArgumentResolver ì˜ supportsParameter() ë¥¼ í˜¸ì¶œí•´ì„œ í•´ë‹¹ íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•˜ëŠ”ì§€ ì²´í¬í•œë‹¤.   
2. ì§€ì› ê°€ëŠ¥í•˜ë©´ `resolveArgument()`ë¥¼ í˜¸ì¶œí•´ì„œ ì‹¤ì œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.    
3. ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ìƒì„±ëœ ê°ì²´ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œì‹œ ë„˜ì–´ê°„ë‹¤.   
       
**ì›í•œë‹¤ë©´ ì§ì ‘ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•´ì„œ ì›í•˜ëŠ” ArgumentResolver ë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.([ì°¸ê³ ](https://jaehun2841.github.io/2018/08/10/2018-08-10-spring-argument-resolver/#custom-argument-resolver-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0))**       
     
## ReturnValueHandler  
  
`HandlerMethodReturnValueHandler`ë¥¼ ì¤„ì—¬ì„œ `ReturnValueHandle`ë¼ ë¶€ë¥¸ë‹¤.       
`ArgumentResolver` ì™€ ë¹„ìŠ·í•œë°, ì´ê²ƒì€ **ì‘ë‹µ ê°’ì„ ë³€í™˜í•˜ê³  ì²˜ë¦¬í•œë‹¤.**           
 
 * ModelAndView 
 * HttpEntity 
 * String
 * @ì–´ë…¸í…Œì´ì…˜   
     
ğŸ‘‰ **ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì–´ë–¤ ê°’ì„ ë°˜í™˜í•´ë„, ì˜ ë™ì‘í•˜ëŠ” ì´ìœ ê°€ ë°”ë¡œ ReturnValueHandler ë•ë¶„ì´ë‹¤.**           

**HttpEntityMethodProcessor**       
(ArgumentResolverì¸ë°, ModelAndViewResolverMethodReturnValueHandlerì—ì„œ í˜¸ì¶œí•´ì„œ ë„£ì—ˆë‹¤.)
```java
    @Override
    public boolean supportsReturnType(MethodParameter returnType) {
        return (HttpEntity.class.isAssignableFrom(returnType.getParameterType()) && !RequestEntity.class.isAssignableFrom(returnType.getParameterType()));
    }
    
    @Override
    public void handleReturnValue(@Nullable Object returnValue, MethodParameter returnType,
                                  ModelAndViewContainer mavContainer, NativeWebRequest webRequest) throws Exception {
        mavContainer.setRequestHandled(true);
	if (returnValue == null) {
	    return;
	}
        ServletServerHttpRequest inputMessage = createInputMessage(webRequest);
	ServletServerHttpResponse outputMessage = createOutputMessage(webRequest);
        
	// ìƒëµ // 
	outputMessage.flush();
   }
```

ìŠ¤í”„ë§ì€ 10ì—¬ê°œê°€ ë„˜ëŠ” ReturnValueHandler ë¥¼ ì§€ì›í•œë‹¤.          
`ArgumentResolver`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©´ì„œ        
í•¸ë“¤ëŸ¬ì˜ ì‘ë‹µ ê°’ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ReturnValueHandler êµ¬í˜„ì²´ë¥¼ ì°¾ì€ í›„ ë™ì‘í•œë‹¤.        
ê°€ëŠ¥í•œ ì‘ë‹µ ê°’ ëª©ë¡ì€ [ê³µì‹ ë©”ë‰´ì–¼](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annreturn-types)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.         
       
## HTTP ë©”ì‹œì§€ ì»¨ë²„í„°            
    
![http-message-converter](https://user-images.githubusercontent.com/50267433/128376402-9cb23dd9-c09e-47b2-952b-14043a452701.PNG)  
       
**HttpMessage ConverterëŠ” ë‹¤ìŒ ë‘ ìœ„ì¹˜ì— ì¡´ì¬í•œë‹¤.**       
* ìš”ì²­ : ArgumentResolver   
* ì‘ë‹µ : ReturnValueHandler   
  
**ìš”ì²­ì˜ ê²½ìš°**    
* `@RequestBody` ë¥¼ ì²˜ë¦¬í•˜ëŠ” ArgumentResolver ê°€ ìˆë‹¤.    
* `HttpEntity` ë¥¼ ì²˜ë¦¬í•˜ëŠ” ArgumentResolver ê°€ ìˆë‹¤.      
* **ArgumentResolver ë“¤ì´ HTTP ë©”ì‹œì§€ ì»¨ë²„í„°ë¥¼ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.**      
    
**ì‘ë‹µì˜ ê²½ìš°**         
* `@ResponseBody` ì™€ `HttpEntity` ë¥¼ ì²˜ë¦¬í•˜ëŠ” ReturnValueHandler ê°€ ìˆë‹¤.         
* ì¦‰, **ReturnValueHandlerì—ì„œ HTTP ë©”ì‹œì§€ ì»¨ë²„í„°ë¥¼ í˜¸ì¶œí•´ì„œ ì‘ë‹µ ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤.**      

### HTTP ë©”ì‹œì§€ ì»¨ë²„í„° ì˜ˆì‹œ  
**HttpEntityMethodProcessor(ArgumentResolver)**  
```java
    // HttpEntityì— ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.    	
    @Override
    @Nullable
    public Object resolveArgument(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer, 
                                  NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) throws IOException, HttpMediaTypeNotSupportedException {
				  
        ServletServerHttpRequest inputMessage = createInputMessage(webRequest);
        Type paramType = getHttpEntityType(parameter);
        if (paramType == null) {
	    throw new IllegalArgumentException("HttpEntity parameter '" + parameter.getParameterName() + "' in method " + parameter.getMethod() + " is not parameterized");
        }
	Object body = readWithMessageConverters(webRequest, parameter, paramType);
        if (RequestEntity.class == parameter.getParameterType()) {
	    return new RequestEntity<>(body, inputMessage.getHeaders(),
	    inputMessage.getMethod(), inputMessage.getURI());
	} else {
	    return new HttpEntity<>(body, inputMessage.getHeaders());
	}
    }	
```
```java
	Object body = readWithMessageConverters(webRequest, parameter, paramType);
```
`ArgumentResolver`ì¸, `HttpEntityMethodProcessor` ì½”ë“œë¥¼ ë“¤ì—¬ë‹¤ë³´ë©´     
`readWithMessageConverters()`ë¥¼ í†µí•´ ì»¨ë²„í„°ë¥¼ ìˆ˜í–‰í•˜ê³  ìˆìŒì„ ì§ì‘í•  ìˆ˜ ìˆë‹¤.    
ì´ë¥¼ ì­‰ íƒ€ê³  ë“¤ì–´ê°€ë©´ `AbstractMessageConverterMethodArgumentResolver`ì˜ `readWithMessageConverters()`ê°€ ìˆëŠ”ë°   


```java
    for (HttpMessageConverter<?> converter : this.messageConverters) {
        Class<HttpMessageConverter<?>> converterType = (Class<HttpMessageConverter<?>>) converter.getClass();
        GenericHttpMessageConverter<?> genericConverter = (converter instanceof GenericHttpMessageConverter ? (GenericHttpMessageConverter<?>) converter : null);
	if (genericConverter != null ? genericConverter.canRead(targetType, contextClass, contentType) : (targetClass != null && converter.canRead(targetClass, contentType))) {
	    if (message.hasBody()) {
	        HttpInputMessage msgToUse = getAdvice().beforeBodyRead(message, parameter, targetType, converterType);
		body = (genericConverter != null ? genericConverter.read(targetType, contextClass, msgToUse) : ((HttpMessageConverter<T>) converter).read(targetClass, msgToUse));
		body = getAdvice().afterBodyRead(body, msgToUse, parameter, targetType, converterType);
	    } else {
	        body = getAdvice().handleEmptyBody(null, message, parameter, targetType, converterType);
	    }
	    break;
	}
    }
```



HTTP ë©”ì‹œì§€ ì»¨ë²„í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” @RequestBody ë„ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” íŒŒë¼ë¯¸í„°ì˜ ê°’ì— ì‚¬ìš©ëœë‹¤.       
@ResponseBody ì˜ ê²½ìš°ë„ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë°˜í™˜ ê°’ì„ ì´ìš©í•œë‹¤.  


> ì°¸ê³ 
> HttpMessageConverter ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ í•œë²ˆ í™•ì¸í•´ë³´ì.
í™•ì¥
ìŠ¤í”„ë§ì€ ë‹¤ìŒì„ ëª¨ë‘ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µí•œë‹¤. ë”°ë¼ì„œ í•„ìš”í•˜ë©´ ì–¸ì œë“ ì§€ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆë‹¤.
HandlerMethodArgumentResolver
HandlerMethodReturnValueHandler
HttpMessageConverter
ìŠ¤í”„ë§ì´ í•„ìš”í•œ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ ê¸°ëŠ¥ì„ í™•ì¥í•  ì¼ì´ ë§ì§€ëŠ” ì•Šë‹¤. ê¸°ëŠ¥ í™•ì¥ì€
WebMvcConfigurer ë¥¼ ìƒì† ë°›ì•„ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ ëœë‹¤. ì‹¤ì œ ìì£¼ ì‚¬ìš©í•˜ì§€ëŠ” ì•Šìœ¼ë‹ˆ ì‹¤ì œ ê¸°ëŠ¥
í™•ì¥ì´ í•„ìš”í•  ë•Œ WebMvcConfigurer ë¥¼ ê²€ìƒ‰í•´ë³´ì.
